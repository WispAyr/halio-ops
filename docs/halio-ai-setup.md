# Halio AI HAT Setup Notes

## Hardware Checklist
- Raspberry Pi 5 with active cooling (Active Cooler or equivalent).
- Halio AI HAT (HAT+ variant) connected via PCIe ribbon and 40-pin header.
- 5V/5A PSU recommended for sustained inference workloads.

## Firmware & OS
1. Update Raspberry Pi OS:
   ```bash
   sudo apt update
   sudo apt full-upgrade
   ```
2. Enable PCIe Gen 3 for maximum bandwidth:
   ```bash
   sudo raspi-config nonint set_pcie_gen3 1
   ```
   Reboot afterward.
3. Confirm the accelerator is detected:
   ```bash
   lspci | grep -i halio
   ```

## Software Stack
- Install Halio SDK (`halctl`) following vendor instructions. Place installers under `vendor/` if you need to track them.
- Populate `.env` with:
  ```ini
  HALIO_DEVICE_PATH=/dev/halio
  HALIO_MODEL_PATH=/opt/halio/models/detect.hbm
  AUTO_INFER=true
  ```
- Ensure GStreamer plugins are present (`scripts/bootstrap-system.sh` covers this).
- Node.js 20 LTS recommended for dashboard/backend (bootstrap script installs it via NodeSource if missing).

## Validating the Accelerator
- Use `halctl status` to confirm device health (API surfaces this via `GET /halio/status`).
- List installed models:
  ```bash
  halctl model list --json
  ```
- Run a sample inference against an MPEG-TS segment generated by the pipeline:
  ```bash
  halctl infer --model $HALIO_MODEL_PATH --input pipelines/output/cam01/segment-00001.ts --output /tmp/cam01.json
  ```

## Troubleshooting
- If PCIe negotiation fails, re-seat the ribbon cable and ensure Gen 3 is enabled.
- Monitor temps with `vcgencmd measure_temp`; throttle if exceeding 80Â°C.
- Check `/var/log/syslog` for PCIe or driver errors.
- Confirm the user running the Node service has read access to `/dev/halio` (use `udev` rules if necessary).
